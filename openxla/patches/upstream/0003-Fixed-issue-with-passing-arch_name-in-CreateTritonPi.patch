From 8cd15718bbd53843236a0ce6359875fa882ae1ca Mon Sep 17 00:00:00 2001
From: Corentin Godeau <corentin.godeau@zml.ai>
Date: Fri, 12 Dec 2025 19:07:35 +0100
Subject: [PATCH] Fixed issue with passing arch_name in CreateTritonPipeline
 for ROCm.

---
 xla/backends/gpu/codegen/triton/compilation_pipeline_rocm.cc | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/xla/backends/gpu/codegen/triton/compilation_pipeline_rocm.cc b/xla/backends/gpu/codegen/triton/compilation_pipeline_rocm.cc
index d2ef805ad4..3353bfd8b3 100644
--- a/xla/backends/gpu/codegen/triton/compilation_pipeline_rocm.cc
+++ b/xla/backends/gpu/codegen/triton/compilation_pipeline_rocm.cc
@@ -66,7 +66,7 @@ static void MakeTTGIR(mlir::OpPassManager* pm,
   pm->addPass(mt::gpu::createTritonGPURemoveLayoutConversions());
   pm->addPass(mt::gpu::createTritonGPUOptimizeThreadLocality());
   // TODO ROCm Pass rocm_cc.gfx_version() after fixing issue with fmfa
-  pm->addPass(mlir::createTritonAMDGPUAccelerateMatmul({arch_name}));
+  pm->addPass(mlir::createTritonAMDGPUAccelerateMatmul({cc.gfx_version()}));
   pm->addPass(mt::gpu::createTritonGPURemoveLayoutConversions());
   // TODO ROCm Check if we want to compare MI100 and greater
   pm->addPass(mlir::createTritonAMDGPUOptimizeEpilogue());
@@ -109,7 +109,7 @@ static void MakeTTGIR(mlir::OpPassManager* pm,
   if (/*use_buffer_ops=*/false) {  // Not enabled by default.
     pm->addPass(mlir::createTritonAMDGPUCanonicalizePointers());
     pm->addPass(mlir::createCanonicalizerPass());
-    pm->addPass(mlir::createTritonAMDGPUConvertToBufferOps({arch_name}));
+    pm->addPass(mlir::createTritonAMDGPUConvertToBufferOps({cc.gfx_version()}));
   }
   pm->addPass(mlir::createTritonAMDFoldTrueCmpI());
   pm->addPass(mlir::createCanonicalizerPass());
-- 
2.39.3 (Apple Git-145)

